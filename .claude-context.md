# Spametrics Dashboard - Claude Context

## Project Overview
Sales and marketing dashboard for Georgia Spa Company. Built with Next.js 14, TypeScript, Tailwind CSS, Supabase PostgreSQL, and Flowbite UI components.

## Last Session: October 29, 2025

### What Was Accomplished
1. **Fixed Data Import Issues**
   - Corrected CSV parsing to read MTD revenue from "Total" row instead of summary label
   - Added support for 7-digit date format (1012025 = 10/1/2025)
   - Applied manual corrections for Oct 8-10 data ($531,955, $538,592, $613,420)
   - Fixed sales rep column mismatch (changed percent_to_goal to mtd_variance)
   - Successfully imported full October data with 595 sales rep records

2. **Implemented Full Navigation**
   - Created sidebar component with Flowbite design
   - Added collapsible stores menu (11 locations)
   - Implemented active state highlighting with blue colors
   - Fixed positioning (sidebar: fixed z-40 w-64, content: ml-64)
   - Blue gradient brand header with chart icon logo

3. **Built Core Dashboard Pages**
   - Main Dashboard (/) - KPI cards, revenue charts, store/rep tables
   - Daily Log (/daily-log) - Date list with filtering
   - Daily Detail (/daily-log/[date]) - Flowbite redesign with modern cards
   - Sales Rep Leaderboard (/sales-reps) - Performance rankings
   - Store Pages (/stores/[store]) - Individual store MTD metrics

4. **Applied Flowbite UI Design**
   - Modern card layouts with shadows and borders
   - Color-coded badges (green/red/yellow for metrics)
   - Clean tables with hover states and region badges
   - Professional typography and spacing
   - Fixed icon imports (ArrowTrendingUpIcon)

5. **Fixed Next.js 16 Issues**
   - Updated dynamic route params to await Promise
   - Removed sticky header overlap with sidebar
   - Fixed layout padding and spacing

### Current State

**Working Features:**
- ✅ Database schema with 6 tables (RLS enabled)
- ✅ CSV import script (scripts/import-full.ts)
- ✅ Dashboard with KPI cards and charts
- ✅ Navigation sidebar with collapsible stores
- ✅ Daily log and detail pages
- ✅ Sales rep leaderboard
- ✅ Individual store pages
- ✅ Manual data correction capability

**Known Issues:**
- ⚠️ Sidebar visibility concerns - may need stronger contrast/colors
- ⚠️ Some Supabase queries return PGRST116 errors (0 rows)
- ⚠️ Store page params errors still showing in logs (code is fixed, may need hard refresh)
- ⚠️ Layout/overlap issues between sidebar and main content reported

**Technical Stack:**
- Next.js 16.0.1 with App Router
- TypeScript
- Tailwind CSS
- Supabase (PostgreSQL)
- Flowbite & Flowbite React
- Heroicons
- Recharts for data visualization

### Configuration

**Environment Variables (.env.local):**
```
NEXT_PUBLIC_SUPABASE_URL=your_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key
```

**Key Commands:**
- `npm run dev` - Start dev server (localhost:3000)
- `npx tsx scripts/import-full.ts` - Import all CSV data
- `npx tsx scripts/manual-correction-oct.ts` - Apply manual corrections

**Database Tables:**
1. `dates` - Date dimension
2. `stores` - Store locations with regions
3. `sales_reps` - Sales representative info
4. `daily_summary_metrics` - Company-wide daily metrics
5. `daily_store_revenue` - Store-level daily data
6. `daily_sales_rep_revenue` - Rep-level daily data

### File Structure
```
gaspa-dashboard/
├── app/
│   ├── layout.tsx (root layout with sidebar)
│   ├── page.tsx (main dashboard)
│   ├── daily-log/
│   │   ├── page.tsx (date list)
│   │   └── [date]/page.tsx (daily detail)
│   ├── sales-reps/page.tsx (leaderboard)
│   └── stores/[store]/page.tsx (store details)
├── components/
│   ├── layout/sidebar.tsx (navigation)
│   ├── dashboard/ (charts and KPI cards)
│   └── ui/ (shadcn components)
├── lib/
│   ├── api.ts (Supabase queries)
│   ├── supabase.ts (client)
│   └── utils.ts (utilities)
├── scripts/
│   ├── import-full.ts (main import)
│   └── manual-correction-oct.ts (corrections)
├── csv-exports/ (all daily CSV files)
└── supabase/schema.sql (database DDL)
```

### Critical Blockers for Next Session
1. **URGENT: Sidebar Visibility & Layout**
   - Sidebar text barely visible in screenshots
   - Content appears to overlap sidebar despite ml-64 spacing
   - Z-index and positioning may not be working correctly
   - Need to verify actual browser rendering vs code changes

2. **Data Quality**
   - Some Supabase queries failing with PGRST116 (0 rows)
   - Verify data import completed successfully
   - Check that all dates have corresponding summary metrics

3. **Browser Caching**
   - Changes may not be hot-reloading properly
   - Need hard refresh (CMD+SHIFT+R) to see updates
   - Consider adding cache-busting or restarting dev server

### Recommended Next Steps
1. **Fix Sidebar Immediately** (CRITICAL)
   - Make sidebar HIGHLY visible with strong colors (dark background or bold borders)
   - Verify content area is truly not overlapping (check actual rendered HTML/CSS)
   - Test z-index layering in browser dev tools
   - Add visual separation (thick border, shadow, or spacing)

2. **Verify Data Integrity**
   - Run query to check daily_summary_metrics has data for all dates
   - Investigate PGRST116 errors
   - Confirm manual corrections were applied

3. **Polish UI/UX**
   - Improve sidebar contrast and visibility
   - Add loading states
   - Error handling for missing data
   - Responsive design for mobile

4. **Add Features**
   - Date range filtering
   - Export functionality
   - User preferences
   - Real-time updates

### Important Technical Notes

**Sidebar Implementation:**
- Located at: `components/layout/sidebar.tsx`
- Fixed positioning: `fixed top-0 left-0 z-40 w-64 h-screen`
- Layout spacing: `ml-64` on main content wrapper
- Active states use blue-50 background and blue-600 text
- Collapsible stores menu with useState

**Layout Structure:**
```tsx
<body>
  <Sidebar /> {/* fixed, z-40, w-64 */}
  <div className="ml-64 min-h-screen">
    <main className="p-6">
      {children} {/* page content */}
    </main>
  </div>
</body>
```

**Date Format Parsing:**
- 8-digit: 10012025 = 10/01/2025
- 7-digit: 1012025 = 10/1/2025
- 5-digit: 10125 = 1/1/2025
- Dot-separated: 10.1.2025

**CSV Structure:**
- MTD Revenue read from row where column C = "Total", column F
- Daily revenue per store in columns
- Sales rep data in lower rows

### Gotchas to Remember
- Next.js 16 requires `await params` in dynamic routes
- Flowbite icons: Use ArrowTrendingUpIcon not TrendingUpIcon
- Supabase `.single()` fails if 0 or >1 rows (use `.maybeSingle()` if optional)
- CSV files have inconsistent date formats - parser handles multiple formats
- Store names: "Lake Oconee" in DB, "Oconee" in display, "lake-oconee" in URL
- Manual corrections needed when source data has errors

### Session Summary
This session focused on implementing full navigation, fixing data import issues, and redesigning pages with Flowbite UI. While functionality was added, critical UI/layout issues with the sidebar remain unresolved and need immediate attention in the next session. The sidebar visibility and content overlap are blocking issues that prevent the dashboard from being production-ready.

**Bottom Line:** Dashboard has all core features but sidebar UI is broken and needs immediate fix before any other work.
