# Spametrics Dashboard - Claude Context

## Project Overview
Sales and marketing dashboard for Georgia Spa Company. Built with Next.js 14, TypeScript, Tailwind CSS, Supabase PostgreSQL, and Flowbite UI components.

## Last Session: October 30, 2025

### What Was Accomplished
1. **Comprehensive Mobile UX Overhaul**
   - Implemented mobile-responsive hamburger navigation with slide-in sidebar
   - Added overlay backdrop and body scroll lock for mobile menu
   - Auto-close menu on navigation for better UX
   - Created touch-optimized menu button (44px tap target)

2. **Responsive Layout System**
   - Converted all layouts to mobile-first approach
   - Dashboard: 1-column → 2-column → 3-column grid (mobile → tablet → desktop)
   - Rep detail pages: 2-column KPI grid on mobile, 4-column on desktop
   - Edge-to-edge headers on mobile with proper padding
   - Responsive spacing: `gap-4 sm:gap-6 lg:gap-8`, `mb-4 sm:mb-6`

3. **Table Optimizations**
   - Made all tables horizontally scrollable with smooth overflow
   - Implemented sticky first column (Date) on activity tables
   - Added `whitespace-nowrap` to prevent text wrapping
   - Responsive font sizes: `text-xs sm:text-sm`
   - Full-bleed tables on mobile: `-mx-6 sm:mx-0`

4. **Chart Enhancements**
   - Increased chart height from 300px to 350px for better mobile viewing
   - Optimized margins and padding for mobile: `px-2 sm:px-6`
   - Adjusted tick font sizes and Y-axis width for more space
   - Better data visualization on small screens

5. **Touch & Interaction Improvements**
   - All buttons now minimum 44px height on mobile (Apple HIG compliant)
   - Added `touch-manipulation` CSS for faster tap response
   - Active state feedback: `active:scale-95` for tactile feel
   - Improved link and button tap targets throughout

6. **PWA & iOS Optimizations**
   - Added proper viewport configuration with zoom enabled
   - iOS-specific meta tags: web app capable, status bar styling
   - Safe area insets for iPhone notch and home indicator
   - Theme color matching brand identity
   - Smooth scrolling with webkit font smoothing

7. **Landscape Mode Support**
   - Custom CSS media queries for landscape phones (`max-height: 600px`)
   - Reduced vertical spacing automatically
   - Compact card headers and padding
   - Charts limited to 250px height in landscape
   - Better use of horizontal screen space

8. **Typography & Accessibility**
   - Responsive text sizes throughout: `text-xs sm:text-sm lg:text-base`
   - Maintained readability at all breakpoints
   - Proper heading hierarchy: `text-xl sm:text-2xl lg:text-3xl`
   - Monospace fonts for numbers (easier scanning)

9. **Deployment**
   - Pushed all mobile improvements to GitHub
   - Deployed to Vercel production successfully
   - Build completed without errors
   - All TypeScript checks passing

### Previous Session: October 29, 2025

#### What Was Accomplished
1. **Fixed Data Import Issues**
   - Corrected CSV parsing to read MTD revenue from "Total" row instead of summary label
   - Added support for 7-digit date format (1012025 = 10/1/2025)
   - Applied manual corrections for Oct 8-10 data ($531,955, $538,592, $613,420)
   - Fixed sales rep column mismatch (changed percent_to_goal to mtd_variance)
   - Successfully imported full October data with 595 sales rep records

2. **Implemented Full Navigation**
   - Created sidebar component with Flowbite design
   - Added collapsible stores menu (11 locations)
   - Implemented active state highlighting with blue colors
   - Fixed positioning (sidebar: fixed z-40 w-64, content: ml-64)
   - Blue gradient brand header with chart icon logo

3. **Built Core Dashboard Pages**
   - Main Dashboard (/) - KPI cards, revenue charts, store/rep tables
   - Daily Log (/daily-log) - Date list with filtering
   - Daily Detail (/daily-log/[date]) - Flowbite redesign with modern cards
   - Sales Rep Leaderboard (/sales-reps) - Performance rankings
   - Store Pages (/stores/[store]) - Individual store MTD metrics

4. **Applied Flowbite UI Design**
   - Modern card layouts with shadows and borders
   - Color-coded badges (green/red/yellow for metrics)
   - Clean tables with hover states and region badges
   - Professional typography and spacing
   - Fixed icon imports (ArrowTrendingUpIcon)

5. **Fixed Next.js 16 Issues**
   - Updated dynamic route params to await Promise
   - Removed sticky header overlap with sidebar
   - Fixed layout padding and spacing

### Current State

**Working Features:**
- ✅ Database schema with 6 tables (RLS enabled)
- ✅ CSV import script (scripts/import-full.ts)
- ✅ Dashboard with KPI cards and charts
- ✅ Mobile-responsive navigation with hamburger menu
- ✅ Responsive layouts for mobile, tablet, and desktop
- ✅ Touch-optimized interactions (44px tap targets)
- ✅ Horizontally scrollable tables with sticky columns
- ✅ PWA-ready with iOS optimizations
- ✅ Landscape mode support
- ✅ Daily log and detail pages
- ✅ Sales rep leaderboard and detail pages
- ✅ Individual store pages
- ✅ Manual data correction capability
- ✅ Deployed to Vercel production

**Production URLs:**
- **Vercel**: https://gaspa-dashboard-iaqyqw75n-pointdog.vercel.app
- **GitHub**: https://github.com/mikeusry/spametrics.git

**Known Issues:**
- ⚠️ Need to configure environment variables in Vercel dashboard
- ⚠️ Some Supabase queries may return PGRST116 errors (0 rows) - needs data verification

**Technical Stack:**
- Next.js 16.0.1 with App Router
- TypeScript
- Tailwind CSS
- Supabase (PostgreSQL)
- Flowbite & Flowbite React
- Heroicons
- Recharts for data visualization

### Configuration

**Environment Variables (.env.local):**
```
NEXT_PUBLIC_SUPABASE_URL=your_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key
```

**Key Commands:**
- `npm run dev` - Start dev server (localhost:3000)
- `npx tsx scripts/import-full.ts` - Import all CSV data
- `npx tsx scripts/manual-correction-oct.ts` - Apply manual corrections

**Database Tables:**
1. `dates` - Date dimension
2. `stores` - Store locations with regions
3. `sales_reps` - Sales representative info
4. `daily_summary_metrics` - Company-wide daily metrics
5. `daily_store_revenue` - Store-level daily data
6. `daily_sales_rep_revenue` - Rep-level daily data

### File Structure
```
gaspa-dashboard/
├── app/
│   ├── layout.tsx (root layout with sidebar)
│   ├── page.tsx (main dashboard)
│   ├── daily-log/
│   │   ├── page.tsx (date list)
│   │   └── [date]/page.tsx (daily detail)
│   ├── sales-reps/page.tsx (leaderboard)
│   └── stores/[store]/page.tsx (store details)
├── components/
│   ├── layout/sidebar.tsx (navigation)
│   ├── dashboard/ (charts and KPI cards)
│   └── ui/ (shadcn components)
├── lib/
│   ├── api.ts (Supabase queries)
│   ├── supabase.ts (client)
│   └── utils.ts (utilities)
├── scripts/
│   ├── import-full.ts (main import)
│   └── manual-correction-oct.ts (corrections)
├── csv-exports/ (all daily CSV files)
└── supabase/schema.sql (database DDL)
```

### Critical Tasks for Next Session
1. **Configure Vercel Environment Variables** (CRITICAL)
   - Go to Vercel Dashboard → Settings → Environment Variables
   - Add all required env vars from .env.local:
     - NEXT_PUBLIC_SUPABASE_URL
     - NEXT_PUBLIC_SUPABASE_ANON_KEY
     - AUTH_PASSWORD
     - AUTH_SECRET
     - HUBSPOT_API_KEY
     - HUBSPOT_COMPANY_ID
   - Trigger new deployment after adding variables
   - Verify production site loads correctly

2. **Test Mobile Experience**
   - Test on actual iPhone (Safari)
   - Verify hamburger menu works smoothly
   - Check table scrolling on rep detail pages
   - Test landscape mode orientation
   - Verify touch targets feel natural
   - Add to Home Screen and test PWA

3. **Data Quality & HubSpot Integration**
   - Verify HubSpot API integration is working
   - Check sales rep activity data is importing
   - Investigate any PGRST116 errors
   - Confirm all dates have corresponding metrics

### Recommended Next Steps
1. **Complete Production Deployment**
   - Configure environment variables in Vercel
   - Test full authentication flow
   - Verify database connectivity in production
   - Share live URL with stakeholders

2. **Add Advanced Features**
   - Date range filtering/comparison
   - Data export (CSV/PDF)
   - Real-time HubSpot sync
   - Email reports/alerts
   - User preferences/settings

3. **Performance Optimization**
   - Add loading states and skeletons
   - Implement data caching strategy
   - Optimize bundle size
   - Add service worker for offline support

4. **Analytics & Monitoring**
   - Add error tracking (Sentry)
   - Implement usage analytics
   - Set up uptime monitoring
   - Create admin dashboard

### Important Technical Notes

**Mobile-Responsive Sidebar:**
- Located at: `components/layout/sidebar.tsx`
- Desktop: Fixed positioning `fixed top-0 left-0 z-40 w-64 h-screen`
- Mobile: Slide-in from left with transform, hamburger menu button (top-left)
- Backdrop overlay with blur on mobile when open
- Auto-closes on route navigation
- Body scroll lock when menu is open
- Layout spacing: `lg:ml-64` (no margin on mobile, hamburger button has space)

**Layout Structure:**
```tsx
<body>
  {/* Mobile hamburger button (lg:hidden) */}
  <button className="lg:hidden fixed top-4 left-4 z-50">
    <Menu /> or <X />
  </button>

  {/* Sidebar - slides in on mobile, fixed on desktop */}
  <Sidebar className="lg:translate-x-0 [mobile: -translate-x-full when closed]" />

  {/* Main content - responsive margin */}
  <main className="lg:ml-64 p-4 sm:p-6 pt-16 lg:pt-6">
    {children}
  </main>
</body>
```

**Responsive Breakpoints:**
```css
< 640px  (sm:)  - Phone portrait
< 768px  (md:)  - Phone landscape / Small tablet
< 1024px (lg:)  - Tablet / iPad (sidebar becomes hamburger)
< 1280px (xl:)  - Desktop
```

**Mobile CSS Optimizations:**
```css
/* Landscape phones (max-height: 600px) */
- Reduced vertical spacing
- Compact card headers
- Charts max-height: 250px

/* Safe area insets (iPhone notch/home indicator) */
- padding-bottom: env(safe-area-inset-bottom)

/* Touch optimizations */
- touch-manipulation (faster tap response)
- min-height: 44px for buttons (Apple HIG)
```

**Date Format Parsing:**
- 8-digit: 10012025 = 10/01/2025
- 7-digit: 1012025 = 10/1/2025
- 5-digit: 10125 = 1/1/2025
- Dot-separated: 10.1.2025

**CSV Structure:**
- MTD Revenue read from row where column C = "Total", column F
- Daily revenue per store in columns
- Sales rep data in lower rows

### Gotchas to Remember
- Next.js 16 requires `await params` in dynamic routes
- Flowbite icons: Use ArrowTrendingUpIcon not TrendingUpIcon
- Supabase `.single()` fails if 0 or >1 rows (use `.maybeSingle()` if optional)
- CSV files have inconsistent date formats - parser handles multiple formats
- Store names: "Lake Oconee" in DB, "Oconee" in display, "lake-oconee" in URL
- Manual corrections needed when source data has errors

### Session Summary
This session focused exclusively on comprehensive mobile UX improvements, transforming the dashboard from a desktop-only application into a world-class mobile-responsive experience. All layouts were converted to mobile-first design, with special attention to iPhone users including PWA support, iOS optimizations, and landscape mode handling. The dashboard is now production-ready with proper touch targets, scrollable tables, responsive grids, and smooth animations. Successfully deployed to Vercel production.

**Bottom Line:** Dashboard is now fully mobile-responsive and production-ready. Next critical step is configuring environment variables in Vercel to complete production deployment.
